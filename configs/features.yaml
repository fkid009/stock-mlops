# Feature definitions for stock prediction

primary_features:
  return_1d:
    description: "1-day return (yesterday vs today)"
    formula: "(close - close.shift(1)) / close.shift(1)"

  return_5d:
    description: "5-day return"
    formula: "(close - close.shift(5)) / close.shift(5)"

  volume_ratio:
    description: "Volume relative to 20-day average"
    formula: "volume / volume.rolling(20).mean()"

  high_low_range:
    description: "Daily price range relative to open"
    formula: "(high - low) / open"

  bollinger_position:
    description: "Position within Bollinger Bands (0=lower, 1=upper)"
    formula: "(close - (ma20 - 2*std20)) / (4 * std20)"
    window: 20

  momentum_10d:
    description: "10-day return (mid-term momentum)"
    formula: "close.pct_change(10)"

  volume_price_divergence:
    description: "Divergence between price direction and volume trend"
    formula: "sign(price_change_5d) * -(vol_ma5/vol_ma20 - 1)"
    window: 20

  volatility_ratio:
    description: "5-day / 20-day volatility ratio (regime indicator)"
    formula: "returns.rolling(5).std() / returns.rolling(20).std()"
    window: 20

  gap_ratio:
    description: "Overnight gap (today's open / yesterday's close - 1)"
    formula: "open / close.shift(1) - 1"

secondary_features:
  ma_5_20_ratio:
    description: "5-day MA / 20-day MA ratio"
    formula: "close.rolling(5).mean() / close.rolling(20).mean()"

  rsi_14:
    description: "14-day Relative Strength Index"
    window: 14

  volatility_20:
    description: "20-day rolling standard deviation of returns"
    window: 20

  macd_signal:
    description: "MACD histogram normalized by close price"
    formula: "(ema12 - ema26 - signal9) / close"

  rsi_divergence:
    description: "5-day change in RSI (momentum acceleration)"
    formula: "rsi_14 - rsi_14.shift(5)"

  close_location_value:
    description: "Close position within daily range (0=low, 1=high)"
    formula: "(close - low) / (high - low)"

preprocessing:
  scaler: "StandardScaler"
  missing_values:
    method: "forward_fill"
    max_consecutive_missing: 5

target:
  name: "next_day_direction"
  description: "Next day price movement (1=up, 0=down)"
  threshold: 0.001  # Â±0.1% considered neutral (excluded)
